// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"  // เปลี่ยนจาก sqlite เป็น postgresql
  url      = env("DATABASE_URL")
}

// โมเดลผู้ใช้งาน
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  phone     String?
  role      String @default("STUDENT")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  bookings  Booking[]
  payments  Payment[]
}

// โมเดลหอพัก
model Dormitory {
  id          String   @id @default(cuid())
  name        String
  address     String
  description String?
  imageUrl    String?
  facilities  String?  // JSON string เก็บสิ่งอำนวยความสะดวก
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  rooms       Room[]
}

// โมเดลห้องพัก
model Room {
  id           String     @id @default(cuid())
  roomNumber   String
  dormitoryId  String
  type         String
  capacity     Int
  price        Float
  floor        Int
  status       String @default("AVAILABLE")
  description  String?
  imageUrl     String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  
  dormitory    Dormitory  @relation(fields: [dormitoryId], references: [id], onDelete: Cascade)
  bookings     Booking[]
  
  @@unique([dormitoryId, roomNumber])
}

// โมเดลการจองห้อง
model Booking {
  id          String        @id @default(cuid())
  userId      String
  roomId      String
  startDate   DateTime
  endDate     DateTime?
  status      String @default("PENDING")
  totalAmount Float
  notes       String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  room        Room          @relation(fields: [roomId], references: [id], onDelete: Cascade)
  payments    Payment[]
}

// โมเดลการชำระเงิน
model Payment {
  id            String        @id @default(cuid())
  bookingId     String
  userId        String
  amount        Float         // ยอดรวมทั้งหมด
  
  // รายละเอียดค่าใช้จ่าย
  rentAmount    Float?        // ค่าเช่า
  waterAmount   Float?        // ค่าน้ำ
  electricAmount Float?       // ค่าไฟ
  otherAmount   Float?        // ค่าอื่นๆ (ค่าส่วนกลาง, ค่าขยะ, etc.)
  
  // ข้อมูลการใช้งาน (optional)
  waterUsage    Float?        // หน่วยน้ำที่ใช้
  electricUsage Float?        // หน่วยไฟที่ใช้
  
  paymentDate   DateTime      @default(now())
  paymentMethod String
  status        String @default("PENDING")
  slipUrl       String?       // URL ของสลิปการโอนเงิน
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  booking       Booking       @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}
