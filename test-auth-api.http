### ==========================================
### Authentication API Testing
### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Login, Register, JWT
### ==========================================

@baseUrl = http://localhost:3000/api
@accessToken = YOUR_ACCESS_TOKEN_HERE
@refreshToken = YOUR_REFRESH_TOKEN_HERE

### ==========================================
### 1. REGISTER (‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô)
### ==========================================

### 1.1 Register Student
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "student.test@example.com",
  "password": "password123",
  "firstName": "‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
  "lastName": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
  "phone": "0812345678"
}

### 1.2 Register Admin
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "admin.test@example.com",
  "password": "admin123",
  "firstName": "‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•",
  "lastName": "‡∏£‡∏∞‡∏ö‡∏ö",
  "phone": "0898765432",
  "role": "ADMIN"
}

### 1.3 Register with duplicate email (‡∏Ñ‡∏ß‡∏£ error 409)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "student.test@example.com",
  "password": "password123",
  "firstName": "Test",
  "lastName": "User"
}

### 1.4 Register with invalid email (‡∏Ñ‡∏ß‡∏£ error 400)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "invalid-email",
  "password": "password123",
  "firstName": "Test",
  "lastName": "User"
}

### 1.5 Register with short password (‡∏Ñ‡∏ß‡∏£ error 400)
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "123",
  "firstName": "Test",
  "lastName": "User"
}

### ==========================================
### 2. LOGIN (‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö)
### ==========================================

### 2.1 Login with correct credentials
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "student.test@example.com",
  "password": "password123"
}

### 2.2 Login with wrong password (‡∏Ñ‡∏ß‡∏£ error 401)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "student.test@example.com",
  "password": "wrongpassword"
}

### 2.3 Login with non-existent email (‡∏Ñ‡∏ß‡∏£ error 401)
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "notexist@example.com",
  "password": "password123"
}

### 2.4 Login Admin
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin.test@example.com",
  "password": "admin123"
}

### ==========================================
### 3. GET CURRENT USER (‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)
### ==========================================

### 3.1 Get current user (‡∏ï‡πâ‡∏≠‡∏á login ‡∏Å‡πà‡∏≠‡∏ô)
GET {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}

### 3.2 Get current user without token (‡∏Ñ‡∏ß‡∏£ error 401)
GET {{baseUrl}}/auth/me

### 3.3 Get current user with invalid token (‡∏Ñ‡∏ß‡∏£ error 401)
GET {{baseUrl}}/auth/me
Authorization: Bearer invalid_token_here

### ==========================================
### 4. UPDATE CURRENT USER
### ==========================================

### 4.1 Update current user info
PUT {{baseUrl}}/auth/me
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "firstName": "‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)",
  "lastName": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï)",
  "phone": "0887654321"
}

### ==========================================
### 5. REFRESH TOKEN
### ==========================================

### 5.1 Refresh access token
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

### 5.2 Refresh with invalid token (‡∏Ñ‡∏ß‡∏£ error 401)
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "invalid_refresh_token"
}

### 5.3 Refresh without token (‡∏Ñ‡∏ß‡∏£ error 400)
POST {{baseUrl}}/auth/refresh
Content-Type: application/json

{}

### ==========================================
### 6. LOGOUT
### ==========================================

### 6.1 Logout
POST {{baseUrl}}/auth/logout
Authorization: Bearer {{accessToken}}

### ==========================================
### 7. PROTECTED ROUTES (‡∏ó‡∏î‡∏™‡∏≠‡∏ö JWT Authentication)
### ==========================================

### 7.1 Access protected route WITH token
GET {{baseUrl}}/users
Authorization: Bearer {{accessToken}}

### 7.2 Access protected route WITHOUT token (‡∏Ñ‡∏ß‡∏£ error 401)
GET {{baseUrl}}/users

### 7.3 Create booking WITH token
POST {{baseUrl}}/bookings
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "userId": "YOUR_USER_ID",
  "roomId": "YOUR_ROOM_ID",
  "startDate": "2025-12-01",
  "totalAmount": 3000
}

### ==========================================
### 8. ROLE-BASED ACCESS (‡∏ó‡∏î‡∏™‡∏≠‡∏ö Authorization)
### ==========================================

### 8.1 Admin access (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô ADMIN)
# ‡πÉ‡∏ä‡πâ admin token
GET {{baseUrl}}/users
Authorization: Bearer YOUR_ADMIN_TOKEN

### 8.2 Student trying to access admin route (‡∏Ñ‡∏ß‡∏£ error 403)
# ‡πÉ‡∏ä‡πâ student token
GET {{baseUrl}}/users
Authorization: Bearer YOUR_STUDENT_TOKEN

### ==========================================
### 9. TOKEN EXPIRATION TEST
### ==========================================

### 9.1 Use expired token (‡∏Ñ‡∏ß‡∏£ error 401)
GET {{baseUrl}}/auth/me
Authorization: Bearer EXPIRED_TOKEN_HERE

### ==========================================
### üìù WORKFLOW EXAMPLE
### ==========================================

### Step 1: Register
# POST /api/auth/register
# ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å accessToken ‡πÅ‡∏•‡∏∞ refreshToken

### Step 2: Login (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ account ‡πÅ‡∏•‡πâ‡∏ß)
# POST /api/auth/login
# ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å accessToken ‡πÅ‡∏•‡∏∞ refreshToken

### Step 3: Access Protected Routes
# ‡πÉ‡∏™‡πà Authorization: Bearer {accessToken} ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å request

### Step 4: Refresh Token (‡πÄ‡∏°‡∏∑‡πà‡∏≠ accessToken ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)
# POST /api/auth/refresh
# ‡πÑ‡∏î‡πâ accessToken ‡πÉ‡∏´‡∏°‡πà

### Step 5: Logout
# POST /api/auth/logout
# ‡∏•‡∏ö tokens ‡∏ù‡∏±‡πà‡∏á client

### ==========================================
### üìä EXPECTED RESPONSES
### ==========================================

### Register/Login Success:
# {
#   "success": true,
#   "data": {
#     "user": { id, email, firstName, lastName, role },
#     "tokens": {
#       "accessToken": "eyJhbGc...",
#       "refreshToken": "eyJhbGc...",
#       "tokenType": "Bearer",
#       "expiresIn": "7d"
#     }
#   },
#   "message": "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
# }

### Get Current User Success:
# {
#   "success": true,
#   "data": {
#     "id": "...",
#     "email": "...",
#     "firstName": "...",
#     "lastName": "...",
#     "role": "...",
#     "bookings": [...],
#     "payments": [...]
#   }
# }

### Error Response:
# {
#   "success": false,
#   "error": "error message"
# }

### ==========================================
### üîí SECURITY NOTES
### ==========================================

# 1. ‡πÄ‡∏Å‡πá‡∏ö JWT_SECRET ‡πÉ‡∏ô .env (‡∏≠‡∏¢‡πà‡∏≤ commit)
# 2. ‡πÉ‡∏ä‡πâ HTTPS ‡πÉ‡∏ô production
# 3. ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ expiration ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
# 4. Refresh token ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡∏¢‡∏≤‡∏ß‡∏Å‡∏ß‡πà‡∏≤ access token
# 5. ‡∏•‡∏ö token ‡πÄ‡∏°‡∏∑‡πà‡∏≠ logout
# 6. ‡πÉ‡∏ä‡πâ httpOnly cookies ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
